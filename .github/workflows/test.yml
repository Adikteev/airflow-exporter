name: Test airflow-exporter

on: [push]

jobs:

  test:
 
    runs-on: ubuntu-latest
 
    steps:
    - uses: actions/checkout@v1
    - name: Run test
      env:
        AIRFLOW_VERSION: 1.10.4

      run: |
        docker-compose up -d postgresql
        docker-compose run airflow /entrypoint.sh airflow initdb
        docker-compose run airflow /entrypoint.sh airflow unpause dummy_dag
        docker-compose run airflow /entrypoint.sh airflow trigger_dag dummy_dag

        # Start the tests container (sut) and attach airflow stdout as well
        docker-compose -f docker-compose.yml -f docker-compose.test.yml up --abort-on-container-exit --exit-code-from=sut sut airflow
